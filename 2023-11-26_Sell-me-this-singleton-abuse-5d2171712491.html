<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Sell me this singleton abuse</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Sell me this singleton abuse</h1>
</header>
<section data-field="subtitle" class="p-summary">
The wolf of dependency injection
</section>
<section data-field="body" class="e-content">
<section name="32f9" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="4b0b" id="4b0b" class="graf graf--h3 graf--leading graf--title">Sell me this singleton abuse</h3><h4 name="4688" id="4688" class="graf graf--h4 graf-after--h3 graf--subtitle">The wolf of dependency injection</h4><figure name="9ea8" id="9ea8" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="1*bANfVEYqVy5TUyvNPaB3VQ.png" data-width="1684" data-height="983" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*bANfVEYqVy5TUyvNPaB3VQ.png"><figcaption class="imageCaption">From movie ‚ÄúThe wolf of Wall¬†street‚Äù</figcaption></figure><h4 name="1597" id="1597" class="graf graf--h4 graf-after--figure"><strong class="markup--strong markup--h4-strong">The real question is this: was all this¬†legal?</strong></h4><blockquote name="2279" id="2279" class="graf graf--blockquote graf-after--h4">Let me tell you something. There‚Äôs no nobility in poverty. I have been a rich man and I have been a poor man. And I choose rich every fuckin‚Äô time.</blockquote><blockquote name="3cb1" id="3cb1" class="graf graf--blockquote graf-after--blockquote">‚Äî Jordan Belfort</blockquote><p name="d221" id="d221" class="graf graf--p graf-after--blockquote">Here‚Äôs a pen:</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="e8e0" id="e8e0" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">AppContainer</span> {<br />    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> `default`: <span class="hljs-type">Container</span> <span class="hljs-operator">=</span> {<br />        <span class="hljs-keyword">let</span> container <span class="hljs-operator">=</span> <span class="hljs-type">Container</span>()<br />        <br />        <span class="hljs-comment">// Register your services and dependencies here</span><br />        container.register(<span class="hljs-type">NetworkManagerProtocol</span>.<span class="hljs-keyword">self</span>) { <span class="hljs-keyword">_</span> <span class="hljs-keyword">in</span><br />            <span class="hljs-type">NetworkManager</span>()<br />        }<br />        <br />        container.register(<span class="hljs-type">ImageDownloaderManagerProtocol</span>.<span class="hljs-keyword">self</span>) { c <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">let</span> network <span class="hljs-operator">=</span> c.resolve(<span class="hljs-type">NetworkManagerProtocol</span>.<span class="hljs-keyword">self</span>)<span class="hljs-operator">!</span><br />            <span class="hljs-keyword">return</span> <span class="hljs-type">ImageDownloaderManager</span>(with: network)<br />        }<br />        <br />        container.register(<span class="hljs-type">MoviesServiceProtocol</span>.<span class="hljs-keyword">self</span>) { c <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">let</span> network <span class="hljs-operator">=</span> c.resolve(<span class="hljs-type">NetworkManagerProtocol</span>.<span class="hljs-keyword">self</span>)<span class="hljs-operator">!</span><br />            <span class="hljs-keyword">return</span> <span class="hljs-type">MoviesService</span>(with: network)<br />        }<br />                <br />        <span class="hljs-keyword">return</span> <span class="hljs-type">Container</span>(parent: container)<br />    }()<br />}</span></pre><p name="f137" id="f137" class="graf graf--p graf-after--pre">Now, sell me this pen.</p><p name="3185" id="3185" class="graf graf--p graf-after--p">Can you in good conscience tell me it‚Äôs OK to wrap a network manager in a <strong class="markup--strong markup--p-strong">VALUE TYPE? </strong>With force unwraps and useless boilerplates everywhere?</p><p name="7257" id="7257" class="graf graf--p graf-after--p">No?</p><p name="d535" id="d535" class="graf graf--p graf-after--p">Let me tell you something. There‚Äôs no nobility in poverty. Everybody wants to write brute force but pretends to be a good developer.<strong class="markup--strong markup--p-strong"> It sells</strong>. You can‚Äôt sell ‚Äúlearn how to code lol‚Äù.</p><p name="b04b" id="b04b" class="graf graf--p graf-after--p">This post is about how we can learn this technique, by learning from the wolf of DI himself:</p><p name="7bc0" id="7bc0" class="graf graf--p graf-after--p"><a href="https://medium.com/@mihail_salari/efficient-dependency-management-in-ios-introducing-appcontainer-for-mpv-di-architecture-fa6f691381b7" data-href="https://medium.com/@mihail_salari/efficient-dependency-management-in-ios-introducing-appcontainer-for-mpv-di-architecture-fa6f691381b7" class="markup--anchor markup--p-anchor" target="_blank">Efficient Dependency Management in iOS: Introducing AppContainer for MVP+DI architecture</a></p><p name="6d0a" id="6d0a" class="graf graf--p graf-after--p">See? <code class="markup--code markup--p-code">Efficient</code>¬†,<code class="markup--code markup--p-code">MVP</code>¬†, <code class="markup--code markup--p-code">DI</code>¬†, <code class="markup--code markup--p-code">architecture</code>¬†.</p><p name="7b1c" id="7b1c" class="graf graf--p graf-after--p">This is how you sell a pen. Nobody will ask for ‚Äúproof‚Äù.</p><p name="306a" id="306a" class="graf graf--p graf-after--p">I‚Äôve made fun of that article before, in my <a href="https://swift2931.medium.com/the-di-crashers-c336fbcd0614" data-href="https://swift2931.medium.com/the-di-crashers-c336fbcd0614" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">DI crashers </a>post, in case you are wondering.</p><p name="ac64" id="ac64" class="graf graf--p graf-after--p">But he made a follow-up post that elevated him to a new prestige level. Let‚Äôs watch in awe how he does it.</p><h4 name="2f07" id="2f07" class="graf graf--h4 graf-after--p"><strong class="markup--strong markup--h4-strong">You can watch me, mock me, try to block me. But you cannot stop¬†me.</strong></h4><blockquote name="aff8" id="aff8" class="graf graf--blockquote graf-after--h4">So I was sellin‚Äô them shit, but the way I looked at it, the money was better off in my pocket</blockquote><blockquote name="b5e7" id="b5e7" class="graf graf--blockquote graf-after--blockquote">‚Äî Jordan Belfort</blockquote><p name="20aa" id="20aa" class="graf graf--p graf-after--blockquote">I left ‚Äúconstructive‚Äù comments on why it‚Äôs so full of shit to put reference type in value type.</p><p name="29d5" id="29d5" class="graf graf--p graf-after--p">Does this question have objective answer? I think so. After all ‚Äúwhen to use value type‚Äù is interview question 101.</p><p name="0381" id="0381" class="graf graf--p graf-after--p">You‚Äôd expect that he would either pretend he didn‚Äôt see it or double down. Instead he published an <em class="markup--em markup--p-em">alternative</em>:</p><p name="1f72" id="1f72" class="graf graf--p graf-after--p"><a href="https://medium.com/@mihail_salari/revisiting-appcontainer-embracing-the-final-class-for-dependency-injection-in-swift-%EF%B8%8F-7ca272b37439" data-href="https://medium.com/@mihail_salari/revisiting-appcontainer-embracing-the-final-class-for-dependency-injection-in-swift-%EF%B8%8F-7ca272b37439" class="markup--anchor markup--p-anchor" target="_blank">Revisiting AppContainer: Embracing the </a><code class="markup--code markup--p-code"><a href="https://medium.com/@mihail_salari/revisiting-appcontainer-embracing-the-final-class-for-dependency-injection-in-swift-%EF%B8%8F-7ca272b37439" data-href="https://medium.com/@mihail_salari/revisiting-appcontainer-embracing-the-final-class-for-dependency-injection-in-swift-%EF%B8%8F-7ca272b37439" class="markup--anchor markup--p-anchor" target="_blank">final class</a></code><a href="https://medium.com/@mihail_salari/revisiting-appcontainer-embracing-the-final-class-for-dependency-injection-in-swift-%EF%B8%8F-7ca272b37439" data-href="https://medium.com/@mihail_salari/revisiting-appcontainer-embracing-the-final-class-for-dependency-injection-in-swift-%EF%B8%8F-7ca272b37439" class="markup--anchor markup--p-anchor" target="_blank"> for Dependency Injection in Swift üõ†Ô∏è</a></p><p name="aa23" id="aa23" class="graf graf--p graf-after--p">In which he said:</p><blockquote name="4b33" id="4b33" class="graf graf--blockquote graf-after--p">In a previous article, I introduced the <code class="markup--code markup--blockquote-code">AppContainer</code> concept, utilizing a <code class="markup--code markup--blockquote-code">struct</code> to manage dependencies in Swift. The community response was insightful, with a blend of support and constructive feedback. While many embraced the <strong class="markup--strong markup--blockquote-strong">straightforward nature of the </strong><code class="markup--code markup--blockquote-code"><strong class="markup--strong markup--blockquote-strong">struct</strong></code>, <strong class="markup--strong markup--blockquote-strong">some posed intriguing questions regarding potential alternatives, like the </strong><code class="markup--code markup--blockquote-code"><strong class="markup--strong markup--blockquote-strong">final class</strong></code><strong class="markup--strong markup--blockquote-strong">.</strong></blockquote><blockquote name="466a" id="466a" class="graf graf--blockquote graf-after--blockquote">Today, I‚Äôll walk you through this alternative approach,<strong class="markup--strong markup--blockquote-strong"> not as a replacement, but as another option to have up your sleeve.</strong></blockquote><p name="4a8a" id="4a8a" class="graf graf--p graf-after--blockquote">This is brilliant. So brilliant in fact that I don‚Äôt even want to discuss details of his design. Let‚Äôs view this from a marketing perspective.</p><p name="dade" id="dade" class="graf graf--p graf-after--p">First <code class="markup--code markup--p-code">struct</code> has this <em class="markup--em markup--p-em">straightforward nature</em>. Wtf is this nature? Is this an official term in Swift? Or in programming?</p><p name="8e34" id="8e34" class="graf graf--p graf-after--p">It deflects any criticism with a term he invented. He <em class="markup--em markup--p-em">felt</em>.</p><p name="0471" id="0471" class="graf graf--p graf-after--p">Second, he reprased ‚Äúdude you are dead wrong‚Äù as <em class="markup--em markup--p-em">intriguing questions</em><strong class="markup--strong markup--p-strong">. </strong>As if there are no objective answers to whether <code class="markup--code markup--p-code">NetworkManager</code> has reference type semantics.</p><p name="eb82" id="eb82" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Third, he used your criticism, his mistakes, to sell you another pen!</strong></p><p name="459e" id="459e" class="graf graf--p graf-after--p">This is how you sell two pens at once!</p><p name="43f4" id="43f4" class="graf graf--p graf-after--p">He is not a run-of-the-mill injection idiot. He is a <em class="markup--em markup--p-em">Wolf, </em>and he means <em class="markup--em markup--p-em">business</em>. He is not going to argue technical details like value type semantics, he may not even believe in DI; But he knows what sells and how to sell it.</p><p name="c5e8" id="c5e8" class="graf graf--p graf-after--p">To make this even more convincing, you need 3 other things. Title, connection, and a website.</p><p name="a1fd" id="a1fd" class="graf graf--p graf-after--p">Guess what? He had it all. Senior iOS Engineer / Tech Lead with linkedin and hisname.com.</p><p name="9120" id="9120" class="graf graf--p graf-after--p">Of course you‚Äôd believe him. Hell, you might want to work for him.</p><h4 name="059e" id="059e" class="graf graf--h4 graf-after--p"><strong class="markup--strong markup--h4-strong">You show me some adjectives. </strong>I quit my job right now and work for¬†you</h4><figure name="e01f" id="e01f" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="1*y8iSqmHjQPxOYkOBrcefKQ.png" data-width="1205" data-height="821" src="https://cdn-images-1.medium.com/max/800/1*y8iSqmHjQPxOYkOBrcefKQ.png"><figcaption class="imageCaption">One of his 700+ followers</figcaption></figure><p name="ed99" id="ed99" class="graf graf--p graf-after--figure">There‚Äôs an iconic feature in his argument. He will use adjectives that make no sense if you take time to think about it.</p><p name="2645" id="2645" class="graf graf--p graf-after--p">E.g.;</p><blockquote name="5aad" id="5aad" class="graf graf--blockquote graf-after--p">Benefits of <code class="markup--code markup--blockquote-code">final class</code> in Dependency Management:</blockquote><blockquote name="256d" id="256d" class="graf graf--blockquote graf-after--blockquote">Reference Semantics: The <code class="markup--code markup--blockquote-code">final class</code> approach is inherently a reference type, ensuring a single instance, making it <strong class="markup--strong markup--blockquote-strong">conducive </strong>to the singleton pattern.</blockquote><blockquote name="f160" id="f160" class="graf graf--blockquote graf-after--blockquote"><strong class="markup--strong markup--blockquote-strong">Cleaner</strong> Singleton Implementation: The <code class="markup--code markup--blockquote-code">final class</code> provides an <strong class="markup--strong markup--blockquote-strong">elegant </strong>path to encapsulating services and dependencies in a shared instance, making the codebase more <strong class="markup--strong markup--blockquote-strong">intuitive</strong>.</blockquote><p name="c4e9" id="c4e9" class="graf graf--p graf-after--blockquote">What does <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">conductive</em></strong><em class="markup--em markup--p-em"> </em>even mean?</p><p name="e6a5" id="e6a5" class="graf graf--p graf-after--p"><code class="markup--code markup--p-code">Final class</code> is NOT <em class="markup--em markup--p-em">inherently</em> a reference type. It <strong class="markup--strong markup--p-strong">IS</strong> a reference type.</p><p name="68e0" id="68e0" class="graf graf--p graf-after--p"><code class="markup--code markup--p-code">Final class</code> is NOT <em class="markup--em markup--p-em">ENSURING</em> a single instance, <code class="markup--code markup--p-code">static</code> is. What is there to <em class="markup--em markup--p-em">ENSURE</em>? This is like saying <code class="markup--code markup--p-code">final class</code> is a singleton, <em class="markup--em markup--p-em">ensuring </em>a single instance, making it <em class="markup--em markup--p-em">conductive</em> to the singleton pattern. Wtf are you talking about?</p><p name="3466" id="3466" class="graf graf--p graf-after--p"><em class="markup--em markup--p-em">Cleaner</em> singleton implies some singleton is <em class="markup--em markup--p-em">clean</em> to begin with. As if there‚Äôs no such thing as singleton abuse. Only <em class="markup--em markup--p-em">clean</em> and <em class="markup--em markup--p-em">cleaner</em>.</p><p name="bcae" id="bcae" class="graf graf--p graf-after--p">The only thing special about <code class="markup--code markup--p-code">final class</code> is <code class="markup--code markup--p-code">final</code>¬†. But somehow it provides an <em class="markup--em markup--p-em">elegant</em> path? There are just 3 paths: you put it in <code class="markup--code markup--p-code">struct</code>¬†, in <code class="markup--code markup--p-code">class</code>¬†, or as global variable. What about putting it in <code class="markup--code markup--p-code">struct</code>¬†? A <em class="markup--em markup--p-em">beautiful </em>path? Making the codebase <em class="markup--em markup--p-em">intuitive </em>because‚Ä¶? Is this what we call <strong class="markup--strong markup--p-strong">singleton abuse</strong> now? <em class="markup--em markup--p-em">Elegant</em> and <em class="markup--em markup--p-em">intuitive</em>?</p><p name="5a56" id="5a56" class="graf graf--p graf-after--p">Even the norm makes no sense. What exactly do you manage with <em class="markup--em markup--p-em">dependency management</em>?</p><p name="0f6f" id="0f6f" class="graf graf--p graf-after--p">Let&#39;s see his example:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="3dbd" id="3dbd" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppContainer</span> {<br />    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> `default` <span class="hljs-operator">=</span> <span class="hljs-type">AppContainer</span>()<br />    <br />    <span class="hljs-keyword">let</span> container <span class="hljs-operator">=</span> <span class="hljs-type">Container</span>()<br />    <br />    <span class="hljs-keyword">private</span> <span class="hljs-keyword">init</span>() {<br />        register()<br />    }<br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">resolve</span>&lt;<span class="hljs-type">Item</span>&gt;(<span class="hljs-keyword">_</span> <span class="hljs-params">item</span>: <span class="hljs-type">Item</span>.<span class="hljs-keyword">Type</span>) -&gt; <span class="hljs-type">Item</span>? {<br />        <span class="hljs-keyword">return</span> container.resolve(item)<br />    }<br />    <br />    <span class="hljs-keyword">private</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">register</span>() {<br />        container.register(<span class="hljs-type">NetworkManagerProtocol</span>.<span class="hljs-keyword">self</span>) { <span class="hljs-keyword">_</span> <span class="hljs-keyword">in</span><br />            <span class="hljs-type">NetworkManager</span>()<br />        }<br />    }<br />}</span></pre><p name="b644" id="b644" class="graf graf--p graf-after--pre">So you have a default <code class="markup--code markup--p-code">NetworkManager</code> in a default container. The question is you have no way to track who registers what.</p><p name="6e98" id="6e98" class="graf graf--p graf-after--p">What if I replaced <code class="markup--code markup--p-code">NetworkManager</code> in runtime? Other devs have no way to know that, they assume it to be a<code class="markup--code markup--p-code">NetworkManager</code> instance. And again, what good is a <code class="markup--code markup--p-code">NetworkManager</code> if it has to be replaced all the time? If it is not to be replaced, why bother with all these boilerplate? Just make a <code class="markup--code markup--p-code">NetworkManager</code> singleton. It is, as he said, an <em class="markup--em markup--p-em">elegant path</em>, right?</p><p name="1cc1" id="1cc1" class="graf graf--p graf-after--p">This cannot scale. Nobody had time to implement the protocol from scratch; nobody had time to trace code to see what‚Äôs in <code class="markup--code markup--p-code">default</code> container.</p><p name="081e" id="081e" class="graf graf--p graf-after--p">And you shouldn‚Äôt have to. That‚Äôs why we do things locally with local properties. By using singleton, you create new problems before ‚Äúsolving‚Äù anything. And it doesn‚Äôt solve shit.</p><p name="9990" id="9990" class="graf graf--p graf-after--p">Continuing my anology from DI crashers, instead of having your TV fixed in your living room, you chose to build a <em class="markup--em markup--p-em">factory</em>.</p><p name="1b91" id="1b91" class="graf graf--p graf-after--p">This factory builds a TV everytime you want to watch it. I call it, an <em class="markup--em markup--p-em">elegant path</em>.It builds everything else in your living room too. Your living room is a place full of cardboards. You register specifications on the cardboard to the factory first. The factory then <em class="markup--em markup--p-em">resolves dependencies</em> as necessary components to build that thing from scratch.</p><p name="4f5a" id="4f5a" class="graf graf--p graf-after--p">Everytime you go to your living room, you collect cardboards first, then you go to factory to find products that are built according to the specs on cardboards. Since all your family members register their shit to the factory, the factory is full of other shit. Your wife registered her own TVs. You want to try it, but it‚Äôs hard to track what‚Äôs special about her TVs, because it‚Äôs a recursive problem; it‚Äôs made of other components which require other components. So you stick to your TV, this is the thing you are familiar with the most after all. <strong class="markup--strong markup--p-strong">&quot;An elegant path&quot;</strong>, you told yourself.</p><p name="ea1d" id="ea1d" class="graf graf--p graf-after--p">After reconstructing your living room from scratch and transporting every item from factory, you are filled with gratitude, so you post this to the comment section:</p><blockquote name="d39b" id="d39b" class="graf graf--blockquote graf-after--p">I appreciate too sharing this article with us, a singleton here looks more clearly! Thanks a lot!</blockquote><p name="de67" id="de67" class="graf graf--p graf-after--blockquote"><strong class="markup--strong markup--p-strong">This, is how you sell singleton abuse.</strong></p><h4 name="9869" id="9869" class="graf graf--h4 graf-after--p">The show goes¬†on!</h4><figure name="8524" id="8524" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="1*nvGpUMc5drGgPwdOZ-kZQw.png" data-width="1134" data-height="579" src="https://cdn-images-1.medium.com/max/800/1*nvGpUMc5drGgPwdOZ-kZQw.png"></figure><blockquote name="61b3" id="61b3" class="graf graf--blockquote graf-after--figure">I want you to deal with your problems by becoming rich!</blockquote><blockquote name="3e6c" id="3e6c" class="graf graf--blockquote graf-after--blockquote">‚Äî Jordan Belfort</blockquote><p name="3b5a" id="3b5a" class="graf graf--p graf-after--blockquote">As a comparison, I want you to deal with your problems by becoming rich in knowledge.</p><p name="2ce4" id="2ce4" class="graf graf--p graf-after--p">Take his quote for example:</p><blockquote name="df78" id="df78" class="graf graf--blockquote graf-after--p">When it came to designing the <code class="markup--code markup--blockquote-code">AppContainer</code>, the <code class="markup--code markup--blockquote-code">struct</code> was appealing due to its inherent<strong class="markup--strong markup--blockquote-strong"> safety</strong> and predictability.</blockquote><p name="54e6" id="54e6" class="graf graf--p graf-after--blockquote">Which refers to the ‚Äúpen‚Äù at the start:</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="c443" id="c443" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">AppContainer</span> {<br />    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> `default`: <span class="hljs-type">Container</span> <span class="hljs-operator">=</span> {<br />        <span class="hljs-keyword">let</span> container <span class="hljs-operator">=</span> <span class="hljs-type">Container</span>()<br />        <br />        <span class="hljs-comment">// Register your services and dependencies here</span><br />        container.register(<span class="hljs-type">NetworkManagerProtocol</span>.<span class="hljs-keyword">self</span>) { <span class="hljs-keyword">_</span> <span class="hljs-keyword">in</span><br />            <span class="hljs-type">NetworkManager</span>()<br />        }<br />        <br />        container.register(<span class="hljs-type">ImageDownloaderManagerProtocol</span>.<span class="hljs-keyword">self</span>) { c <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">let</span> network <span class="hljs-operator">=</span> c.resolve(<span class="hljs-type">NetworkManagerProtocol</span>.<span class="hljs-keyword">self</span>)<span class="hljs-operator">!</span><br />            <span class="hljs-keyword">return</span> <span class="hljs-type">ImageDownloaderManager</span>(with: network)<br />        }<br />        <br />        container.register(<span class="hljs-type">MoviesServiceProtocol</span>.<span class="hljs-keyword">self</span>) { c <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">let</span> network <span class="hljs-operator">=</span> c.resolve(<span class="hljs-type">NetworkManagerProtocol</span>.<span class="hljs-keyword">self</span>)<span class="hljs-operator">!</span><br />            <span class="hljs-keyword">return</span> <span class="hljs-type">MoviesService</span>(with: network)<br />        }<br />                <br />        <span class="hljs-keyword">return</span> <span class="hljs-type">Container</span>(parent: container)<br />    }()<br />}</span></pre><p name="88dc" id="88dc" class="graf graf--p graf-after--pre">Where‚Äôs the value type safety? <code class="markup--code markup--p-code">AppContainer.default</code> is a reference type.</p><p name="da66" id="da66" class="graf graf--p graf-after--p">There are even two force unwraps! Safety??? You are supposed to handle optionals, not force it!</p><p name="7bc4" id="7bc4" class="graf graf--p graf-after--p">How many times you repeat <code class="markup--code markup--p-code">container</code>¬†, <code class="markup--code markup--p-code">NetworkManager</code>¬†, <code class="markup--code markup--p-code">Protocol</code>¬†, <code class="markup--code markup--p-code">self</code>¬†? Your arguments should not be because I have this much generalization so I need a singleton to re-use them. Your arguments should be why you need this much generalization in the first place.</p><p name="5ff6" id="5ff6" class="graf graf--p graf-after--p">Look at <code class="markup--code markup--p-code">MovieService</code>¬†, seriously? Rewrite a <code class="markup--code markup--p-code">NetworkManager</code> for every endpoint? This is called brute force. I‚Äôm selling you brute force while making you feel like you are part of a <em class="markup--em markup--p-em">movement</em>. MVP + DI + elegant by a Lead developer.</p><p name="7825" id="7825" class="graf graf--p graf-after--p">His conclusion:</p><blockquote name="d843" id="d843" class="graf graf--blockquote graf-after--p">Both <code class="markup--code markup--blockquote-code">structs</code> and <code class="markup--code markup--blockquote-code">final class</code> have their strengths, and the decision often boils down to specific project requirements. With the performance being similar for our use-case,<strong class="markup--strong markup--blockquote-strong"> the choice becomes more about coding style and preferences.</strong> The <code class="markup--code markup--blockquote-code">final class</code> approach provides a <strong class="markup--strong markup--blockquote-strong">clean </strong>and straightforward way to manage shared instances, which can be handy in certain scenarios.</blockquote><p name="48f4" id="48f4" class="graf graf--p graf-after--blockquote">So <code class="markup--code markup--p-code">struct</code> is beautiful, <code class="markup--code markup--p-code">final class</code> is elegant. Where‚Äôs singleton abuse? The choice is never about coding style. It‚Äôs about value type semantics! Which is interview question 101!</p><p name="a082" id="a082" class="graf graf--p graf-after--p">The ironic part is that, <em class="markup--em markup--p-em">Lead </em>developers like him, if his title is anything to go by, are the ones asking you this in interview.</p><p name="2073" id="2073" class="graf graf--p graf-after--p">I‚Äôm going to sell you singleton abuse, I‚Äôm going to ignore value type to pump all other shit like view model, but I‚Äôll make sure you know the distinction in interview. This is the industry.</p><p name="cc05" id="cc05" class="graf graf--p graf-after--p">It‚Äôs funny he also thinks over-engineering of DI is a misconception in the lead-up article.</p><blockquote name="f53d" id="f53d" class="graf graf--blockquote graf-after--p">2. The Need for Dependency Injection</blockquote><blockquote name="29ea" id="29ea" class="graf graf--blockquote graf-after--blockquote"><strong class="markup--strong markup--blockquote-strong">For newcomers, Dependency Injection might sound like an over-engineered solution</strong>. However, the benefits are multifold:</blockquote><blockquote name="7506" id="7506" class="graf graf--blockquote graf-after--blockquote">Decoupling: Separate out the different parts of your application to make it modular.</blockquote><blockquote name="ce66" id="ce66" class="graf graf--blockquote graf-after--blockquote">Testability: Replace real implementations with mock ones for unit tests.</blockquote><blockquote name="3536" id="3536" class="graf graf--blockquote graf-after--blockquote">Scalability: Easily switch out one implementation for another, especially useful as your app grows.</blockquote><p name="30c8" id="30c8" class="graf graf--p graf-after--blockquote">For ‚ÄúLead devs‚Äù, dependency injection might NOT sound like an over-engineered solution, however the problems are multifold:</p><p name="5492" id="5492" class="graf graf--p graf-after--p">Decoupling doesn‚Äôt require injection from outside.</p><p name="3a93" id="3a93" class="graf graf--p graf-after--p">Mocking requires implementing protocols from scratch, which actually makes it more difficult. You are not writing production code so you can test in a more difficult way. You design so production code is easier to write.</p><p name="053c" id="053c" class="graf graf--p graf-after--p">Scalability doesn‚Äôt need swapping out implementation in runtime. Look at his <code class="markup--code markup--p-code">NetworkManager</code>¬†, just a brute force re-implementation for every endpoint. This kind of design makes it not scalable.</p><blockquote name="c737" id="c737" class="graf graf--blockquote graf-after--p"><strong class="markup--strong markup--blockquote-strong">The Real Question Is This: Was All This Scalable? Absolutely F**king Not.‚Äù</strong></blockquote><h4 name="589f" id="589f" class="graf graf--h4 graf-after--blockquote">Everything is¬†fine</h4><figure name="1a0d" id="1a0d" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="1*GaFFW4DT5r3z7jH6bJPWMw.jpeg" data-width="612" data-height="408" src="https://cdn-images-1.medium.com/max/800/1*GaFFW4DT5r3z7jH6bJPWMw.jpeg"></figure><p name="8448" id="8448" class="graf graf--p graf-after--figure">I want to quit too.</p><p name="3d60" id="3d60" class="graf graf--p graf-after--p">He got about 50 claps for each article. All he said are adjectives that made no sense. I had to go toe-to-toe with so called <em class="markup--em markup--p-em">Lead </em>devs, even<em class="markup--em markup--p-em"> industry titans </em>to fight against industry norms, to get 10 claps, occasionally.</p><p name="4d90" id="4d90" class="graf graf--p graf-after--p">Where‚Äôs my Donnie? Who will leave this kind of comment?</p><blockquote name="e02c" id="e02c" class="graf graf--blockquote graf-after--p">I appreciate too sharing this article with us, a singleton here looks more clearly! Thanks a lot!</blockquote><p name="c894" id="c894" class="graf graf--p graf-after--blockquote">It is as the movie said, supply and demand.</p><blockquote name="2528" id="2528" class="graf graf--blockquote graf-after--p">Brad: Why don‚Äôt you do me a favor. Write your name down on that napkin for me.</blockquote><blockquote name="9b6b" id="9b6b" class="graf graf--blockquote graf-after--blockquote">Jordan Belfort: I don‚Äôt have a pen.</blockquote><blockquote name="d9e1" id="d9e1" class="graf graf--blockquote graf-after--blockquote">Brad: Exactly. Supply and demand, my friend.</blockquote><p name="2557" id="2557" class="graf graf--p graf-after--blockquote">Why don‚Äôt you do me a favor. Refactor out brute force so I can reuse.</p><p name="45ca" id="45ca" class="graf graf--p graf--startsWithDoubleQuote graf-after--p">‚ÄúI don‚Äôt have a singleton‚Äù.</p><p name="3269" id="3269" class="graf graf--p graf-after--p">Exactly.</p><p name="c646" id="c646" class="graf graf--p graf-after--p">You know what, I‚Äôm gonna cheer myself up. I‚Äôm not a Wolf. I‚Äôm Batman.</p><figure name="0bf3" id="0bf3" class="graf graf--figure graf-after--p graf--trailing"><img class="graf-image" data-image-id="1*3y7EPPY0rzM697c0Yk7SnQ.jpeg" data-width="538" data-height="464" src="https://cdn-images-1.medium.com/max/800/1*3y7EPPY0rzM697c0Yk7SnQ.jpeg"></figure></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@swift2931" class="p-author h-card">Jim Lai</a> on <a href="https://medium.com/p/5d2171712491"><time class="dt-published" datetime="2023-11-26T09:21:10.027Z">November 26, 2023</time></a>.</p><p><a href="https://medium.com/@swift2931/sell-me-this-singleton-abuse-5d2171712491" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on December 9, 2023.</p></footer></article></body></html>